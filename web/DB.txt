FILE DI SPIEGAZIONE DI ALCUNI CODICI PRESENTI NEL DB

SET GLOBAL event_scheduler = ON;

################################################################################

EVENTO PER INSERIRE ALL'INTERNO DI 'weeks_views' UN NUOVO RECORD CON DATA LA DATA
DEL LUNEDì E COME VALORE LA SOMMA DI TUTTE LE VIEWS DELLE VARIE PAGINE FATTE IN
QUELLA SETTIMANA PRESE DA 'curr_week_views'. DOPODICHé TUTTE I VALORI IN 
'curr_week_views' VENGONO eliminati PER RICOMINCIARE LA SETTIMANA


DELIMITER $$    
CREATE EVENT copy_week_views
ON SCHEDULE
  EVERY 1 WEEK
STARTS CURRENT_DATE + INTERVAL 2 DAY do
BEGIN

    INSERT INTO `weeks_views`(pagina, week, views) 

    SELECT pagina, CURRENT_DATE - INTERVAL 7 DAY AS date, SUM(`views`) AS views FROM curr_week_views group by pagina;

    DELETE FROM `curr_week_views`;
    
END $$
DELIMITER ;

################################################################################

SET FOREIGN_KEY_CHECKS=0;

################################################################################

TRIGGER PER AUMENTARE I DEFAULT TIMESTAMP DI DUE ORE SUL SERVER DELL'HOST

DELIMITER $$

CREATE TRIGGER blog_date_trigger
BEFORE INSERT
ON blog FOR EACH ROW

BEGIN

SET NEW.data = CURRENT_TIMESTAMP + INTERVAL 2 HOUR;

END$$ 
DELIMITER ;

DELIMITER $$

CREATE TRIGGER blog_commenti_date_trigger
BEFORE INSERT
ON blog_commenti FOR EACH ROW

BEGIN

SET NEW.data = CURRENT_TIMESTAMP + INTERVAL 2 HOUR;

END$$ 
DELIMITER ;

DELIMITER $$

CREATE TRIGGER commenti_date_trigger
BEFORE INSERT
ON commenti FOR EACH ROW

BEGIN

SET NEW.data = CURRENT_TIMESTAMP + INTERVAL 2 HOUR;

END$$ 
DELIMITER ;

DELIMITER $$

CREATE TRIGGER email_sub_date_trigger
BEFORE INSERT
ON email_sub FOR EACH ROW

BEGIN

SET NEW.date = CURRENT_TIMESTAMP + INTERVAL 2 HOUR;

END$$ 
DELIMITER ;

DELIMITER $$

CREATE TRIGGER orderSumdate_trigger
BEFORE INSERT
ON orderSum FOR EACH ROW

BEGIN

SET NEW.date = CURRENT_TIMESTAMP + INTERVAL 2 HOUR;

END$$ 
DELIMITER ;

DELIMITER $$

CREATE TRIGGER ricette_date_trigger
BEFORE INSERT
ON ricette FOR EACH ROW

BEGIN

SET NEW.data = CURRENT_TIMESTAMP + INTERVAL 2 HOUR;

END$$ 
DELIMITER ;

DELIMITER $$

CREATE TRIGGER notifiche_date_trigger
BEFORE INSERT
ON notifiche FOR EACH ROW

BEGIN

SET NEW.data = CURRENT_TIMESTAMP + INTERVAL 2 HOUR;

END$$ 
DELIMITER ;
################################################################################